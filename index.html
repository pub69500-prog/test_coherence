<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
    <meta content="Coh√©rence Cardiaque" name="apple-mobile-web-app-title"/>
    <title>Coh√©rence Cardiaque</title>
    <!-- PWA Manifest -->
    <link href="manifest.json" rel="manifest"/>
    <!-- Ic√¥nes pour iOS -->
    <link href="icons/icon-192x192.png" rel="apple-touch-icon"/>
    <link href="icons/icon-512x512.png" rel="apple-touch-icon" sizes="512x512"/>
    <!-- Couleur de la barre d'√©tat iOS -->
    <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
    <!-- Th√®me color -->
    <meta content="#2d4654" name="theme-color"/>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&amp;family=Montserrat:wght@200;300;400&amp;display=swap" rel="stylesheet"/>
    <!-- Styles -->
    <link href="css/style.css" rel="stylesheet"/>
</head>
<body>
    <!-- Feuilles nature -->
    <svg class="nature-leaf leaf-1" viewBox="0 0 100 100">
        <path d="M50,10 Q80,30 90,60 Q85,80 70,90 Q60,85 50,90 Q40,60 50,10" fill="currentColor" style="color: var(--secondary);"/>
    </svg>
    <svg class="nature-leaf leaf-2" viewBox="0 0 100 100">
        <path d="M50,10 Q20,30 10,60 Q15,80 30,90 Q40,85 50,90 Q60,60 50,10" fill="currentColor" style="color: var(--accent);"/>
    </svg>
    <svg class="nature-leaf leaf-3" viewBox="0 0 100 100">
        <path d="M50,10 Q80,30 90,60 Q85,80 70,90 Q60,85 50,90 Q40,60 50,10" fill="currentColor" style="color: var(--secondary);"/>
    </svg>

    <!-- Toggle mode sombre -->
    <button class="theme-toggle-btn" id="themeToggle" aria-label="Mode sombre">
        <span class="theme-icon sun">‚òÄÔ∏è</span>
        <span class="theme-icon moon">üåô</span>
    </button>

    <!-- Overlay session plein √©cran OPTIMIS√â -->
    <div class="session-fullscreen" id="sessionFullscreen">
        <!-- Bouton fermeture ‚úñÔ∏è -->
        <button class="session-close-btn" id="sessionCloseBtn" aria-label="Fermer" title="Fermer (ESC)">‚úñÔ∏è</button>
        
        <div class="session-container">
            <div class="session-bubble-zone">
                <div class="session-bubble" id="sessionBubble">
                    <div class="session-bubble-text" id="sessionBubbleText"></div>
                </div>
            </div>
            <div class="session-timer-display" id="sessionTimerDisplay">05:00</div>
            <div class="session-buttons">
                <button class="session-control-btn pause-btn" id="pauseBtn">
                    <span id="pauseIcon">‚è∏Ô∏è</span>
                    <span id="pauseText">Pause</span>
                </button>
                <button class="session-control-btn stop-btn" id="stopBtnSession">
                    <span>‚èπÔ∏è</span>
                    <span>Arr√™t</span>
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>Coh√©rence Cardiaque</h1>
            <div class="subtitle">Harmonie ¬∑ √âquilibre ¬∑ S√©r√©nit√©</div>
        </div>

        <div class="main-content">
            <div class="breathing-zone" id="breathingZone">
                <div class="circle-container">
                    <div class="breathing-circle" id="breathingCircle">
                        <div class="breath-text" id="breathText"></div>
                    </div>
                </div>
                <div class="timer-display" id="timerDisplay">00:00</div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>

            <div class="session-info">
                <div class="session-stat">
                    <div class="session-stat-label">Cycles</div>
                    <div class="session-stat-value" id="cycleCount">0</div>
                </div>
                <div class="session-stat">
                    <div class="session-stat-label">Respirations</div>
                    <div class="session-stat-value" id="breathCount">0</div>
                </div>
            </div>
        </div>

        <div class="control-panel">
            <div class="control-section">
                <label class="control-label">Dur√©e de la s√©ance</label>
                <div class="slider-control">
                    <div class="slider-value" id="durationValue">5 minutes</div>
                    <input type="range" class="custom-slider" id="sessionDuration" min="3" max="30" value="5" step="1"/>
                </div>
            </div>

            <div class="divider"></div>

            <div class="control-section">
                <label class="control-label">Rythme respiratoire</label>
                <div class="input-group">
                    <div class="input-wrapper">
                        <div class="input-label">Inspiration (sec)</div>
                        <div class="slider-control">
                            <div class="slider-value" id="inhaleValue">5 secondes</div>
                            <input type="range" class="custom-slider" id="inhaleTime" min="3" max="10" value="5" step="1"/>
                        </div>
                    </div>
                    <div class="input-wrapper">
                        <div class="input-label">Expiration (sec)</div>
                        <div class="slider-control">
                            <div class="slider-value" id="exhaleValue">5 secondes</div>
                            <input type="range" class="custom-slider" id="exhaleTime" min="3" max="10" value="5" step="1"/>
                        </div>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <div class="control-section">
                <label class="control-label">Sons de respiration</label>
                <div class="input-wrapper">
                    <div class="input-label">Son d'inspiration</div>
                    <select id="inhaleSound">
                        <option value="none">Aucun</option>
                    </select>
                    <div class="volume-control">
                        <span class="volume-icon">üîâ</span>
                        <input class="volume-slider" id="inhaleVolume" max="100" min="0" type="range" value="70"/>
                        <span class="volume-value" id="inhaleVolumeValue">70%</span>
                    </div>
                </div>
                <div class="input-wrapper" style="margin-top: 1rem;">
                    <div class="input-label">Son d'expiration</div>
                    <select id="exhaleSound">
                        <option value="none">Aucun</option>
                    </select>
                    <div class="volume-control">
                        <span class="volume-icon">üîâ</span>
                        <input class="volume-slider" id="exhaleVolume" max="100" min="0" type="range" value="70"/>
                        <span class="volume-value" id="exhaleVolumeValue">70%</span>
                    </div>
                </div>
                <div id="customInhaleUpload" style="display: none; margin-top: 1rem;">
                    <div class="file-input-wrapper">
                        <label class="file-input-label" for="customInhaleFile">
                            üìÅ Choisir un son d'inspiration
                        </label>
                        <input accept="audio/*" id="customInhaleFile" type="file"/>
                    </div>
                    <div class="file-name" id="customInhaleName"></div>
                </div>
                <div id="customExhaleUpload" style="display: none; margin-top: 1rem;">
                    <div class="file-input-wrapper">
                        <label class="file-input-label" for="customExhaleFile">
                            üìÅ Choisir un son d'expiration
                        </label>
                        <input accept="audio/*" id="customExhaleFile" type="file"/>
                    </div>
                    <div class="file-name" id="customExhaleName"></div>
                </div>
            </div>

            <div class="divider"></div>

            <div class="control-section">
                <label class="control-label">Musique d'ambiance</label>
                <div class="file-input-wrapper">
                    <label class="file-input-label" for="backgroundMusic">
                        üéµ Ajouter des musiques de fond
                    </label>
                    <input accept="audio/mp3,audio/mpeg,audio/*" id="backgroundMusic" multiple type="file"/>
                </div>
                <div class="file-name" id="musicFileName"></div>
                <div id="musicLibrary" style="display: none; margin-top: 1rem;">
                    <div class="input-label">Biblioth√®que musicale</div>
                    <div class="music-dropdown">
                        <label for="musicSelect">Choisir une musique</label>
                        <select id="musicSelect">
                            <option value="">‚Äî S√©lectionner ‚Äî</option>
                        </select>
                    </div>
                    <div class="music-list" id="musicList"></div>
                </div>
                <div class="volume-control" id="musicVolumeControl" style="display: none; margin-top: 1rem;">
                    <span class="volume-icon">üéµ</span>
                    <input class="volume-slider" id="musicVolume" max="100" min="0" type="range" value="30"/>
                    <span class="volume-value" id="musicVolumeValue">30%</span>
                </div>
            </div>

            <button class="btn btn-primary" id="startBtn">Commencer</button>
            <button class="btn btn-secondary" id="stopBtn" style="display: none;">Arr√™ter</button>
            <button class="btn btn-secondary history-btn" id="historyBtn" type="button" aria-expanded="false" aria-controls="historyPanel">Historique</button>

            <!-- Panneau Historique (d√©pliable) -->
            <section class="history-panel" id="historyPanel" aria-hidden="true">
                <div class="history-panel-head">
                    <h2 class="history-panel-title">Historique</h2>
                    <button class="icon-btn" id="historyCloseBtn" type="button" aria-label="Fermer">‚úï</button>
                </div>
                <div class="history-grid" id="historyGrid"></div>
                <div class="history-actions">
                    <button class="btn btn-secondary" id="historyResetBtn" type="button">R√©initialiser l'historique</button>
                </div>
            </section>

            <div class="credits">Fait avec ‚ù§Ô∏è par Chris</div>
        </div>
    </div>

    <!-- √âcran de fin de s√©ance (plein √©cran) -->
    <div class="end-screen" id="endScreen" aria-hidden="true">
        <div class="end-screen-card" role="dialog" aria-modal="true" aria-labelledby="endScreenTitle">
            <div class="end-screen-icon" aria-hidden="true">üåø</div>
            <h2 id="endScreenTitle">Te voil√† d√©tendu(e)</h2>
            <p id="endScreenMsg">Prends une seconde pour ressentir le calme. Tu peux relancer une nouvelle s√©ance quand tu veux.</p>
            <button class="btn primary" id="endScreenCloseBtn" type="button">√Ä bient√¥t</button>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script src="js/improvements.js"></script>
    <!-- PWA Service Worker -->
    <script>
        // Gestion de l'installation PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('üí° L\'application peut √™tre install√©e');
        });
    </script>
</body>
</html>